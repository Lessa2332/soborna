<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–æ–±–æ—Ä–Ω–∞ –ü–∏—Å–∞–Ω–∫–∞ | –î–æ—à–∫–∞ —î–¥–Ω–∞–Ω–Ω—è</title>
  
  <!-- –®—Ä–∏—Ñ—Ç–∏ -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  
  <!-- Leaflet –¥–ª—è –∫–∞—Ä—Ç–∏ -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <style>
    :root {
      --bordo: #6a1e2a;
      --bordo-light: #8b2f3c;
      --gold: #c9a03d;
      --gold-light: #e5b73b;
      --cream: #f5eee6;
      --brown: #4a2c1a;
      --beige: #e8d9c0;
      --dark: #1a1a1a;
      --font-heading: 'Cormorant Garamond', 'Times New Roman', serif;
      --font-body: 'Open Sans', 'Helvetica', sans-serif;
      --shadow-lg: 0 8px 32px rgba(106, 30, 42, 0.2);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: var(--font-body);
      background-color: var(--cream);
      color: var(--dark);
      min-height: 100vh;
      background-image: url('data:image/svg+xml;utf8,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><path d="M30 5 L55 30 L30 55 L5 30 Z" fill="none" stroke="%23c9a03d" stroke-width="0.5" opacity="0.1"/></svg>');
      overflow: hidden;
    }
    
    #map-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    #ukraine-map {
      width: 100%;
      height: 100%;
      background: var(--beige);
      z-index: 1;
    }
    
    /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –º–∞—Ä–∫–µ—Ä—ñ–≤-–ø–∏—Å–∞–Ω–æ–∫ */
    .pysanka-marker {
      background: transparent;
      border: none;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
      transition: all 0.3s ease;
      cursor: pointer;
      z-index: 10;
    }
    
    .pysanka-marker:hover {
      transform: scale(1.2) rotate(5deg);
      filter: drop-shadow(0 8px 16px var(--gold));
      z-index: 1000;
    }
    
    .pysanka-egg {
      width: 50px;
      height: 70px;
      background: linear-gradient(135deg, var(--gold), var(--bordo));
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      border: 3px solid white;
      box-shadow: 0 0 20px rgba(201, 160, 61, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      transform: rotate(-10deg);
      position: relative;
    }
    
    .pysanka-egg:after {
      content: '';
      position: absolute;
      top: 5px;
      left: 5px;
      right: 5px;
      bottom: 5px;
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      pointer-events: none;
    }
    
    /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–ø–∞–ø—ñ–≤ */
    .custom-popup {
      font-family: var(--font-heading);
      text-align: center;
      min-width: 150px;
    }
    
    .custom-popup .popup-name {
      color: var(--bordo);
      font-size: 18px;
      font-weight: 700;
      margin: 5px 0;
    }
    
    .custom-popup .popup-city {
      color: var(--gold);
      font-size: 14px;
      font-style: italic;
    }
    
    .custom-popup .popup-region {
      color: var(--brown);
      font-size: 12px;
      margin-top: 5px;
      padding-top: 5px;
      border-top: 1px dashed var(--gold);
    }
    
    .custom-popup .popup-symbol {
      font-size: 32px;
      margin-bottom: 5px;
    }
    
    /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    .stats-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(106, 30, 42, 0.95);
      backdrop-filter: blur(10px);
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: 20px;
      color: white;
      z-index: 100;
      min-width: 280px;
      box-shadow: var(--shadow-lg);
      animation: slideIn 0.5s ease;
      cursor: move;
    }
    
    .stats-panel.minimized {
      min-width: auto;
      padding: 10px 15px;
      cursor: pointer;
    }
    
    .stats-panel.minimized .stats-title {
      font-size: 18px;
      margin-bottom: 0;
      border-bottom: none;
    }
    
    .stats-panel.minimized .stats-number {
      font-size: 24px;
      display: inline-block;
      margin-left: 10px;
    }
    
    .stats-panel.minimized .stats-label,
    .stats-panel.minimized #regionProgress,
    .stats-panel.minimized .participants-list {
      display: none;
    }
    
    .minimize-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: var(--gold);
      font-size: 18px;
      cursor: pointer;
      padding: 5px;
      line-height: 1;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .minimize-btn:hover {
      background: rgba(229, 183, 59, 0.2);
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .stats-title {
      font-family: var(--font-heading);
      font-size: 24px;
      color: var(--gold);
      margin-bottom: 15px;
      text-align: center;
      border-bottom: 1px solid var(--gold);
      padding-bottom: 10px;
      padding-right: 20px;
    }
    
    .stats-number {
      font-size: 48px;
      font-weight: 700;
      color: var(--gold);
      text-align: center;
      margin: 10px 0;
      line-height: 1;
    }
    
    .stats-label {
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 15px;
    }
    
    .participants-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
      border-top: 1px solid rgba(201, 160, 61, 0.3);
      padding-top: 10px;
    }
    
    .participant-item {
      padding: 8px 12px;
      border-bottom: 1px solid rgba(201, 160, 61, 0.2);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .participant-item:hover {
      background: rgba(201, 160, 61, 0.2);
      border-radius: 8px;
    }
    
    .participant-symbol {
      font-size: 20px;
      min-width: 30px;
      text-align: center;
    }
    
    .participant-name {
      color: var(--gold);
      font-weight: 600;
      flex: 1;
    }
    
    .participant-city {
      color: var(--cream);
      font-size: 12px;
      background: rgba(255,255,255,0.1);
      padding: 2px 8px;
      border-radius: 12px;
    }
    
    /* –õ–µ–≥–µ–Ω–¥–∞ */
    .legend-panel {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(106, 30, 42, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid var(--gold);
      border-radius: 16px;
      padding: 15px;
      color: white;
      z-index: 100;
      max-width: 220px;
      border: 2px solid var(--gold);
      animation: slideInLeft 0.5s ease;
    }
    
    @keyframes slideInLeft {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .legend-title {
      font-family: var(--font-heading);
      color: var(--gold);
      margin-bottom: 10px;
      font-size: 18px;
      text-align: center;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      gap: 10px;
    }
    
    .legend-dot {
      width: 30px;
      height: 42px;
      background: linear-gradient(135deg, var(--gold), var(--bordo));
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      border: 2px solid white;
      transform: rotate(-5deg);
    }
    
    .legend-text {
      font-size: 14px;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è */
    .control-panel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .control-btn {
      padding: 12px 24px;
      background: var(--bordo);
      color: var(--gold);
      border: 2px solid var(--gold);
      border-radius: 40px;
      font-family: var(--font-heading);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(5px);
      box-shadow: var(--shadow-lg);
      min-width: 160px;
    }
    
    .control-btn:hover {
      background: var(--gold);
      color: var(--bordo);
      transform: scale(1.05);
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    /* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è */
    .toast-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(106, 30, 42, 0.95);
      border: 2px solid var(--gold);
      border-radius: 40px;
      padding: 15px 30px;
      color: white;
      font-size: 18px;
      z-index: 1000;
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(10px);
      animation: slideDown 0.3s ease;
      white-space: nowrap;
    }
    
    @keyframes slideDown {
      from { transform: translate(-50%, -100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
    
    .toast-message span {
      font-size: 24px;
    }
    
    /* –°–≤—è—Ç–∫–æ–≤–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è */
    .celebration-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(201, 160, 61, 0.3), rgba(106, 30, 42, 0.8));
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s;
      backdrop-filter: blur(5px);
    }
    
    .celebration-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .celebration-content {
      text-align: center;
      color: var(--gold);
      animation: celebrationZoom 1s ease;
    }
    
    @keyframes celebrationZoom {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .celebration-egg {
      font-size: 120px;
      filter: drop-shadow(0 0 30px gold);
      animation: eggSpin 10s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes eggSpin {
      from { transform: rotateY(0deg); }
      to { transform: rotateY(360deg); }
    }
    
    .celebration-title {
      font-family: var(--font-heading);
      font-size: 48px;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    .celebration-text {
      font-size: 24px;
      margin: 20px 0;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
    @media (max-width: 768px) {
      .stats-panel {
        top: 10px;
        right: 10px;
        min-width: 200px;
        padding: 15px;
      }
      
      .stats-number {
        font-size: 36px;
      }
      
      .legend-panel {
        bottom: 10px;
        left: 10px;
        padding: 10px;
      }
      
      .control-panel {
        bottom: 10px;
        right: 10px;
      }
      
      .control-btn {
        padding: 8px 16px;
        min-width: 120px;
        font-size: 14px;
      }
      
      .celebration-title {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div id="map-container">
    <div id="ukraine-map"></div>
  </div>
  
  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="stats-panel" id="statsPanel">
    <button class="minimize-btn" id="minimizeBtn" onclick="toggleMinimize()">‚àí</button>
    <div class="stats-title">ü•ö –°–û–ë–û–†–ù–ê –ü–ò–°–ê–ù–ö–ê</div>
    <div class="stats-number" id="participantCount">0</div>
    <div class="stats-label">—É—á–∞—Å–Ω–∏–∫—ñ–≤</div>
    
    <div id="regionProgress" style="margin-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px;">
        <span>14 —Ä–µ–≥—ñ–æ–Ω—ñ–≤</span>
        <span id="regionsActive">0/14</span>
      </div>
      <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
        <div id="progressBar" style="width: 0%; height: 100%; background: var(--gold); transition: width 0.5s;"></div>
      </div>
    </div>
    
    <div class="participants-list" id="participantsList">
      <div style="text-align: center; opacity: 0.5; padding: 20px;">–ß–µ–∫–∞—î–º–æ –Ω–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤...</div>
    </div>
  </div>
  
  <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
  <div class="legend-panel">
    <div class="legend-title">ü•ö –ü–æ–∑–Ω–∞—á–∫–∏</div>
    <div class="legend-item">
      <div class="legend-dot"></div>
      <span class="legend-text">–£—á–∞—Å–Ω–∏–∫ –∑ –ø–∏—Å–∞–Ω–∫–æ—é (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è —ñ–Ω—Ñ–æ)</span>
    </div>
    <div class="legend-item">
      <div style="width: 30px; height: 30px; background: var(--gold); border-radius: 50%; border: 2px solid white;"></div>
      <span class="legend-text">–ê–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–≥—ñ–æ–Ω</span>
    </div>
  </div>
  
  <!-- –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
  <div class="control-panel">
    <button class="control-btn" onclick="refreshMap()" id="refreshBtn">
      üîÑ –û–Ω–æ–≤–∏—Ç–∏
    </button>
    <button class="control-btn" onclick="showCelebration()" id="celebrateBtn" style="display: none;">
      üéâ –°–≤—è—Ç–∫—É–≤–∞—Ç–∏
    </button>
    <button class="control-btn" onclick="clearAllData()" style="background: #8B0000;">
      üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏
    </button>
  </div>
  
  <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
  <div class="toast-message" id="toastMessage">
    <span>ü•ö</span>
    <span id="toastText">–ù–æ–≤–∏–π —É—á–∞—Å–Ω–∏–∫!</span>
  </div>
  
  <!-- –°–≤—è—Ç–∫—É–≤–∞–Ω–Ω—è -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <div class="celebration-content">
      <div class="celebration-egg">ü•ö</div>
      <div class="celebration-title">–°–û–ë–û–†–ù–ê –ü–ò–°–ê–ù–ö–ê</div>
      <div class="celebration-text">–í—Å—ñ 14 —Ä–µ–≥—ñ–æ–Ω—ñ–≤ —î–¥–∏–Ω—ñ!</div>
      <button class="control-btn" onclick="hideCelebration()" style="background: var(--gold); color: var(--bordo);">
        –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç—É
      </button>
    </div>
  </div>
  
  <script>
    // ============ –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ============
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJ57LtEcJCmCK2eKvKRQVE7eBMBwJGzj4tqpczcd8UCOEUQVkYHg_645-55qeHVl7M/exec';
    
    // ============ –ü–†–ê–í–ò–õ–¨–ù–Ü –ö–û–û–†–î–ò–ù–ê–¢–ò –ú–Ü–°–¢ ============
    const CITY_COORDS = {
      // –ü–æ–¥—ñ–ª–ª—è (1)
      '–≤—ñ–Ω–Ω–∏—Ü—è': { lat: 49.233, lng: 28.468, regionId: 1, region: '–ü–æ–¥—ñ–ª–ª—è' },
      '—Ö–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π': { lat: 49.422, lng: 26.987, regionId: 1, region: '–ü–æ–¥—ñ–ª–ª—è' },
      '—Ç–µ—Ä–Ω–æ–ø—ñ–ª—å': { lat: 49.554, lng: 25.591, regionId: 1, region: '–ü–æ–¥—ñ–ª–ª—è' },
      '–∫–∞–º\'—è–Ω–µ—Ü—å-–ø–æ–¥—ñ–ª—å—Å—å–∫–∏–π': { lat: 48.680, lng: 26.580, regionId: 1, region: '–ü–æ–¥—ñ–ª–ª—è' },
      
      // –ü–æ–ª—ñ—Å—Å—è (2)
      '–∂–∏—Ç–æ–º–∏—Ä': { lat: 50.255, lng: 28.658, regionId: 2, region: '–ü–æ–ª—ñ—Å—Å—è' },
      '—á–µ—Ä–Ω—ñ–≥—ñ–≤': { lat: 51.498, lng: 31.289, regionId: 2, region: '–ü–æ–ª—ñ—Å—Å—è' },
      '—Ä—ñ–≤–Ω–µ': { lat: 50.619, lng: 26.251, regionId: 2, region: '–ü–æ–ª—ñ—Å—Å—è' },
      '–ª—É—Ü—å–∫': { lat: 50.747, lng: 25.324, regionId: 2, region: '–í–æ–ª–∏–Ω—å' },
      '—Å–∞—Ä–∏–Ω': { lat: 51.333, lng: 26.633, regionId: 2, region: '–ü–æ–ª—ñ—Å—Å—è' },
      '–∫–æ—Ä–æ—Å—Ç–µ–Ω—å': { lat: 50.950, lng: 28.633, regionId: 2, region: '–ü–æ–ª—ñ—Å—Å—è' },
      
      // –ö–∞—Ä–ø–∞—Ç–∏ (3)
      '—ñ–≤–∞–Ω–æ-—Ñ—Ä–∞–Ω–∫—ñ–≤—Å—å–∫': { lat: 48.923, lng: 24.711, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '—É–∂–≥–æ—Ä–æ–¥': { lat: 48.621, lng: 22.288, regionId: 3, region: '–ó–∞–∫–∞—Ä–ø–∞—Ç—Ç—è' },
      '—á–µ—Ä–Ω—ñ–≤—Ü—ñ': { lat: 48.292, lng: 25.935, regionId: 3, region: '–ë—É–∫–æ–≤–∏–Ω–∞' },
      '–∫–æ–ª–æ–º–∏—è': { lat: 48.531, lng: 25.040, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '—Ä–∞—Ö–æ–≤': { lat: 48.050, lng: 24.200, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '—Ç—É—Ä–∫–∞': { lat: 49.150, lng: 23.016, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '—Å–∫–æ–ª–µ': { lat: 49.033, lng: 23.516, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '–±–æ–ª–µ—Ö—ñ–≤': { lat: 49.066, lng: 23.866, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      '–¥–æ–ª–∏–Ω–∞': { lat: 48.966, lng: 24.000, regionId: 3, region: '–ö–∞—Ä–ø–∞—Ç–∏' },
      
      // –ö–∏—ó–≤—â–∏–Ω–∞ (4)
      '–∫–∏—ó–≤': { lat: 50.450, lng: 30.524, regionId: 4, region: '–ö–∏—ó–≤—â–∏–Ω–∞' },
      '–±—ñ–ª–∞ —Ü–µ—Ä–∫–≤–∞': { lat: 49.795, lng: 30.117, regionId: 4, region: '–ö–∏—ó–≤—â–∏–Ω–∞' },
      '—Ñ–∞—Å—Ç—ñ–≤': { lat: 50.083, lng: 29.917, regionId: 4, region: '–ö–∏—ó–≤—â–∏–Ω–∞' },
      '–ø–µ—Ä–µ—è—Å–ª–∞–≤': { lat: 50.065, lng: 31.445, regionId: 4, region: '–ö–∏—ó–≤—â–∏–Ω–∞' },
      
      // –õ—å–≤—ñ–≤—â–∏–Ω–∞ (5)
      '–ª—å–≤—ñ–≤': { lat: 49.840, lng: 24.030, regionId: 5, region: '–õ—å–≤—ñ–≤—â–∏–Ω–∞' },
      '–¥—Ä–æ–≥–æ–±–∏—á': { lat: 49.350, lng: 23.500, regionId: 5, region: '–õ—å–≤—ñ–≤—â–∏–Ω–∞' },
      '—Å—Ç—Ä—É—Å—ñ–≤': { lat: 49.383, lng: 24.900, regionId: 5, region: '–õ—å–≤—ñ–≤—â–∏–Ω–∞' },
      
      // –û–¥–µ—â–∏–Ω–∞ (6)
      '–æ–¥–µ—Å–∞': { lat: 46.485, lng: 30.723, regionId: 6, region: '–û–¥–µ—â–∏–Ω–∞' },
      '—ñ–∑–º–∞—ó–ª': { lat: 45.350, lng: 28.840, regionId: 6, region: '–û–¥–µ—â–∏–Ω–∞' },
      '—á–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫': { lat: 46.300, lng: 30.650, regionId: 6, region: '–û–¥–µ—â–∏–Ω–∞' },
      '–±—ñ–ª–≥–æ—Ä–æ–¥-–¥–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π': { lat: 46.183, lng: 30.350, regionId: 6, region: '–û–¥–µ—â–∏–Ω–∞' },
      
      // –•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞ (7)
      '—Ö–∞—Ä–∫—ñ–≤': { lat: 49.993, lng: 36.230, regionId: 7, region: '–•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞' },
      '—ñ–∑—é–º': { lat: 49.200, lng: 37.283, regionId: 7, region: '–•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞' },
      '—á—É–≥—É—ó–≤': { lat: 49.833, lng: 36.683, regionId: 7, region: '–•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞' },
      
      // –î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞ (8)
      '–¥–Ω—ñ–ø—Ä–æ': { lat: 48.464, lng: 35.046, regionId: 8, region: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞' },
      '–∫—Ä–∏–≤–∏–π —Ä—ñ–≥': { lat: 47.910, lng: 33.390, regionId: 8, region: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞' },
      '–∫–∞–º\'—è–Ω—Å—å–∫–µ': { lat: 48.516, lng: 34.600, regionId: 8, region: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞' },
      '–Ω—ñ–∫–æ–ø–æ–ª—å': { lat: 47.566, lng: 34.400, regionId: 8, region: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞' },
      
      // –ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞ (9)
      '–ø–æ–ª—Ç–∞–≤–∞': { lat: 49.589, lng: 34.551, regionId: 9, region: '–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞' },
      '–∫—Ä–µ–º–µ–Ω—á—É–∫': { lat: 49.068, lng: 33.424, regionId: 9, region: '–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞' },
      '–ª—É–±–Ω–∏': { lat: 50.016, lng: 32.983, regionId: 9, region: '–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞' },
      
      // –ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞ (10)
      '—á–µ—Ä–Ω—ñ–≥—ñ–≤': { lat: 51.498, lng: 31.289, regionId: 10, region: '–ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞' },
      '–Ω—ñ–∂–∏–Ω': { lat: 51.050, lng: 31.883, regionId: 10, region: '–ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞' },
      '–ø—Ä–∏–ª—É–∫–∏': { lat: 50.600, lng: 32.383, regionId: 10, region: '–ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞' },
      
      // –ß–µ—Ä–∫–∞—â–∏–Ω–∞ (11)
      '—á–µ—Ä–∫–∞—Å–∏': { lat: 49.444, lng: 32.060, regionId: 11, region: '–ß–µ—Ä–∫–∞—â–∏–Ω–∞' },
      '—É–º–∞–Ω—å': { lat: 48.750, lng: 30.217, regionId: 11, region: '–ß–µ—Ä–∫–∞—â–∏–Ω–∞' },
      '–∑–æ–ª–æ—Ç–æ–Ω–æ—à–∞': { lat: 49.667, lng: 32.033, regionId: 11, region: '–ß–µ—Ä–∫–∞—â–∏–Ω–∞' },
      '—á–∏–≥–∏—Ä–∏–Ω': { lat: 49.083, lng: 32.667, regionId: 11, region: '–ß–µ—Ä–∫–∞—â–∏–Ω–∞' },
      '–∫–∞–Ω—ñ–≤': { lat: 49.750, lng: 31.467, regionId: 11, region: '–ß–µ—Ä–∫–∞—â–∏–Ω–∞' },
      
      // –ö—Ä–∏–º (12)
      '—Å—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å': { lat: 44.952, lng: 34.102, regionId: 12, region: '–ö—Ä–∏–º' },
      '—Å–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å': { lat: 44.617, lng: 33.525, regionId: 12, region: '–ö—Ä–∏–º' },
      '—è–ª—Ç–∞': { lat: 44.500, lng: 34.167, regionId: 12, region: '–ö—Ä–∏–º' },
      '—Ñ–µ–æ–¥–æ—Å—ñ—è': { lat: 45.033, lng: 35.383, regionId: 12, region: '–ö—Ä–∏–º' },
      '—î–≤–ø–∞—Ç–æ—Ä—ñ—è': { lat: 45.200, lng: 33.367, regionId: 12, region: '–ö—Ä–∏–º' },
      '—Ö–µ—Ä—Å–æ–Ω': { lat: 46.655, lng: 32.617, regionId: 12, region: '–•–µ—Ä—Å–æ–Ω—â–∏–Ω–∞' },
      
      // –î–æ–Ω–µ—á—á–∏–Ω–∞ (13)
      '–¥–æ–Ω–µ—Ü—å–∫': { lat: 48.016, lng: 37.803, regionId: 13, region: '–î–æ–Ω–µ—á—á–∏–Ω–∞' },
      '–º–∞—Ä—ñ—É–ø–æ–ª—å': { lat: 47.097, lng: 37.543, regionId: 13, region: '–î–æ–Ω–µ—á—á–∏–Ω–∞' },
      '–∫—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫': { lat: 48.733, lng: 37.583, regionId: 13, region: '–î–æ–Ω–µ—á—á–∏–Ω–∞' },
      '—Å–ª–æ–≤\'—è–Ω—Å—å–∫': { lat: 48.867, lng: 37.617, regionId: 13, region: '–î–æ–Ω–µ—á—á–∏–Ω–∞' },
      
      // –õ—É–≥–∞–Ω—â–∏–Ω–∞ (14)
      '–ª—É–≥–∞–Ω—Å—å–∫': { lat: 48.567, lng: 39.307, regionId: 14, region: '–õ—É–≥–∞–Ω—â–∏–Ω–∞' },
      '—Å—ñ–≤–µ—Ä—Å—å–∫–æ–¥–æ–Ω–µ—Ü—å–∫': { lat: 48.950, lng: 38.483, regionId: 14, region: '–õ—É–≥–∞–Ω—â–∏–Ω–∞' },
      '–ª–∏—Å–∏—á–∞–Ω—Å—å–∫': { lat: 48.917, lng: 38.433, regionId: 14, region: '–õ—É–≥–∞–Ω—â–∏–Ω–∞' },
      '—Å—Ç–∞—Ä—Ä–æ–±—ñ–ª—å—Å—å–∫': { lat: 49.283, lng: 38.917, regionId: 14, region: '–õ—É–≥–∞–Ω—â–∏–Ω–∞' }
    };
    
    // –°–∏–º–≤–æ–ª–∏ –¥–ª—è —Ä–µ–≥—ñ–æ–Ω—ñ–≤
    const REGION_SYMBOLS = {
      1: 'üåª', 2: 'üå≤', 3: 'üèîÔ∏è', 4: 'üèõÔ∏è', 5: 'ü¶Å', 6: '‚öì', 7: '‚öôÔ∏è',
      8: 'üåä', 9: 'üåæ', 10: 'üìö', 11: 'üé≠', 12: 'üèñÔ∏è', 13: '‚õèÔ∏è', 14: 'üåª'
    };
    
    // ============ –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ============
    let map;
    let markers = [];
    let participants = [];
    let previousCount = 0;
    let isMinimized = false;
    
    // ============ –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ============
    document.addEventListener('DOMContentLoaded', function() {
      initMap();
      loadParticipants();
      
      // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥
      setInterval(loadParticipants, 5000);
      
      // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ resize
      window.addEventListener('resize', function() {
        setTimeout(() => {
          map.invalidateSize();
        }, 100);
      });
    });
    
    // ============ –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –ö–ê–†–¢–ò ============
    function initMap() {
      // –¶–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏
      map = L.map('ukraine-map').setView([49.0, 32.0], 6);
      
      // –î–æ–¥–∞—î–º–æ —Å—Ç–∏–ª—å–Ω—É –∫–∞—Ä—Ç—É
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap, &copy; CartoDB',
        maxZoom: 10,
        minZoom: 5
      }).addTo(map);
      
      // –î–æ–¥–∞—î–º–æ –º–µ–∂—ñ –£–∫—Ä–∞—ó–Ω–∏
      const ukraineBounds = L.rectangle([
        [52.4, 22.1],
        [44.4, 40.2]
      ], {
        color: '#6a1e2a',
        weight: 2,
        fill: false,
        dashArray: '5, 5'
      }).addTo(map);
      
      console.log('–ö–∞—Ä—Ç—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
    }
    
    // ============ –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –£–ß–ê–°–ù–ò–ö–Ü–í ============
    function loadParticipants() {
      loadFromLocalStorage();
      loadFromGoogleSheets();
    }
    
    function loadFromLocalStorage() {
      try {
        const saved = localStorage.getItem('pysanka_participants');
        if (saved) {
          const data = JSON.parse(saved);
          if (data.length > 0) {
            participants = data;
            updateMap();
            updateStats();
            
            if (data.length > previousCount) {
              showNewParticipantToast(data[data.length - 1]);
              previousCount = data.length;
            }
          }
        }
      } catch (e) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage:', e);
      }
    }
    
    function loadFromGoogleSheets() {
      fetch(GOOGLE_SCRIPT_URL)
        .then(response => response.json())
        .then(data => {
          if (data && data.length > 0) {
            const googleParticipants = data.map(item => ({
              name: item.name,
              city: item.city,
              region: item.regionName,
              regionId: item.regionId,
              timestamp: item.timestamp,
              coords: getCityCoordinates(item.city),
              symbol: REGION_SYMBOLS[item.regionId] || 'ü•ö'
            }));
            
            const allParticipants = [...participants];
            
            googleParticipants.forEach(gp => {
              const exists = allParticipants.some(p => 
                p.name === gp.name && p.city === gp.city && p.timestamp === gp.timestamp
              );
              if (!exists) {
                allParticipants.push(gp);
              }
            });
            
            if (allParticipants.length > participants.length) {
              participants = allParticipants;
              localStorage.setItem('pysanka_participants', JSON.stringify(participants));
              updateMap();
              updateStats();
              
              if (allParticipants.length > previousCount) {
                showNewParticipantToast(allParticipants[allParticipants.length - 1]);
                previousCount = allParticipants.length;
              }
            }
          }
        })
        .catch(error => {
          console.log('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ Google Sheets, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ');
        });
    }
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º—ñ—Å—Ç–∞
    function getCityCoordinates(cityName) {
      if (!cityName) return { lat: 49.0, lng: 32.0 };
      
      const cityLower = cityName.toLowerCase().trim();
      const coords = CITY_COORDS[cityLower];
      
      if (coords) {
        return { lat: coords.lat, lng: coords.lng, regionId: coords.regionId, region: coords.region };
      }
      
      // –Ø–∫—â–æ –º—ñ—Å—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ü–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏
      return { lat: 49.0, lng: 32.0 };
    }
    
    // ============ –û–ù–û–í–õ–ï–ù–ù–Ø –ö–ê–†–¢–ò ============
    function updateMap() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
      
      if (!participants || participants.length === 0) return;
      
      const regionCount = {};
      
      participants.forEach((p, index) => {
        let coords;
        
        if (p.coords && p.coords.lat && p.coords.lng) {
          coords = p.coords;
        } else if (p.city) {
          coords = getCityCoordinates(p.city);
        } else {
          coords = { lat: 49.0, lng: 32.0 };
        }
        
        const regionId = p.regionId || (coords ? coords.regionId : null);
        if (regionId) {
          regionCount[regionId] = (regionCount[regionId] || 0) + 1;
        }
        
        const marker = createPysankaMarker(p, coords.lat, coords.lng);
        marker.addTo(map);
        markers.push(marker);
      });
      
      updateRegionProgress(regionCount);
    }
    
    function createPysankaMarker(participant, lat, lng) {
      const symbol = participant.symbol || 
                    (participant.regionId ? REGION_SYMBOLS[participant.regionId] : 'ü•ö');
      
      const markerHtml = `
        <div class="pysanka-marker" title="${participant.name}, ${participant.city}">
          <div class="pysanka-egg">
            ${symbol}
          </div>
        </div>
      `;
      
      const icon = L.divIcon({
        className: 'custom-pysanka-marker',
        html: markerHtml,
        iconSize: [50, 70],
        iconAnchor: [25, 35],
        popupAnchor: [0, -35]
      });
      
      const marker = L.marker([lat, lng], { icon: icon });
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –∫—Ä–∞—Å–∏–≤–∏–π –ø–æ–ø–∞–ø –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
      const popupContent = `
        <div class="custom-popup">
          <div class="popup-symbol">${symbol}</div>
          <div class="popup-name">${participant.name}</div>
          <div class="popup-city">${participant.city}</div>
          <div class="popup-region">${participant.region || ''}</div>
          ${participant.wish ? `<div style="margin-top: 10px; font-style: italic;">"${participant.wish}"</div>` : ''}
        </div>
      `;
      
      marker.bindPopup(popupContent, {
        className: 'custom-popup-container',
        minWidth: 200,
        maxWidth: 300
      });
      
      return marker;
    }
    
    // ============ –û–ù–û–í–õ–ï–ù–ù–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò ============
    function updateStats() {
      const count = participants.length;
      document.getElementById('participantCount').textContent = count;
      
      const listEl = document.getElementById('participantsList');
      
      if (count === 0) {
        listEl.innerHTML = '<div style="text-align: center; opacity: 0.5; padding: 20px;">–ß–µ–∫–∞—î–º–æ –Ω–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤...</div>';
        return;
      }
      
      const recentParticipants = [...participants].reverse().slice(0, 8);
      
      listEl.innerHTML = recentParticipants.map(p => `
        <div class="participant-item" onclick="showParticipantOnMap('${p.name}')">
          <span class="participant-symbol">${p.symbol || 'ü•ö'}</span>
          <span class="participant-name">${p.name}</span>
          <span class="participant-city">${p.city}</span>
        </div>
      `).join('');
    }
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É —É—á–∞—Å–Ω–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—ñ –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ —Å–ø–∏—Å–æ–∫
    window.showParticipantOnMap = function(name) {
      const participant = participants.find(p => p.name === name);
      if (participant) {
        const coords = participant.coords || getCityCoordinates(participant.city);
        map.setView([coords.lat, coords.lng], 8);
      }
    };
    
    function updateRegionProgress(regionCount) {
      const activeRegions = Object.keys(regionCount).length;
      document.getElementById('regionsActive').textContent = `${activeRegions}/14`;
      
      const progressPercent = (activeRegions / 14) * 100;
      document.getElementById('progressBar').style.width = progressPercent + '%';
      
      if (activeRegions >= 14) {
        document.getElementById('celebrateBtn').style.display = 'block';
      } else {
        document.getElementById('celebrateBtn').style.display = 'none';
      }
    }
    
    // ============ –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø ============
    function showNewParticipantToast(participant) {
      const toast = document.getElementById('toastMessage');
      const toastText = document.getElementById('toastText');
      
      toastText.textContent = `${participant.name} –∑ –º—ñ—Å—Ç–∞ ${participant.city} –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è!`;
      toast.style.display = 'flex';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }
    
    // ============ –ö–ï–†–£–í–ê–ù–ù–Ø ============
    function refreshMap() {
      loadParticipants();
      
      const toast = document.getElementById('toastMessage');
      const toastText = document.getElementById('toastText');
      
      toastText.textContent = '–ö–∞—Ä—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–æ!';
      toast.style.display = 'flex';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 1500);
    }
    
    function showCelebration() {
      document.getElementById('celebrationOverlay').classList.add('active');
      
      try {
        const audio = new Audio('data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVoAAACAgICAf39/f39/f3+AgICAf39/f39/f3+AgICAf39/f39/f3+AgICAf39/f39/f3+AgICAf39/f39/f3+AgICAf39/f38=');
        audio.play();
      } catch (e) {}
    }
    
    function hideCelebration() {
      document.getElementById('celebrationOverlay').classList.remove('active');
    }
    
    function clearAllData() {
      if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ –ø—Ä–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤?')) {
        localStorage.removeItem('pysanka_participants');
        localStorage.removeItem('pysanka_stats');
        participants = [];
        updateMap();
        updateStats();
        
        const toast = document.getElementById('toastMessage');
        const toastText = document.getElementById('toastText');
        
        toastText.textContent = '–î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ!';
        toast.style.display = 'flex';
        
        setTimeout(() => {
          toast.style.display = 'none';
        }, 1500);
      }
    }
    
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–≥–æ—Ä—Ç–∞–Ω–Ω—è/—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø–∞–Ω–µ–ª—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function toggleMinimize() {
      const panel = document.getElementById('statsPanel');
      const btn = document.getElementById('minimizeBtn');
      
      isMinimized = !isMinimized;
      
      if (isMinimized) {
        panel.classList.add('minimized');
        btn.textContent = '+';
      } else {
        panel.classList.remove('minimized');
        btn.textContent = '‚àí';
      }
    }
    
    // –†–æ–±–∏–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏
    window.refreshMap = refreshMap;
    window.showCelebration = showCelebration;
    window.hideCelebration = hideCelebration;
    window.clearAllData = clearAllData;
    window.toggleMinimize = toggleMinimize;
  </script>
</body>
</html>
